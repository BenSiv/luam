# LuaM

LuaM is a modernized fork of Lua 5.1, featuring a stricter, safer, and more concise syntax. 
It retains the speed and simplicity of Lua 5.1 while adopting features from later Lua versions and modern programming paradigms.

## Key Features

### 1. Safer Syntax
*   **Implicit Locals**: Variables are `local` by default. No need to type `local` everywhere.
    ```lua
    x = 10        -- Local variable
    function f()  -- Local function
    end
    ```
*   **Immutable by Default**: Implicitly declared variables are immutable. Reassignment causes a compile-time error.
    ```lua
    x = 10
    x = 20 -- Error: attempt to assign to immutable variable
    ```
*   **Explicit Mutability**: Use the `mutable` keyword for variables that need to change.
    ```lua
    mutable y = 10
    y = 20 -- OK
    ```

### 2. Modern Operators & Control Flow
*   **Inequality**: Use `!=` instead of `~=`.
    ```lua
    if x != y then ... end
    ```
*   **Else If**: Use `else if` instead of `elseif`.
    ```lua
    if x == 1 then
        ...
    else if x == 2 then
        ...
    end
    ```
*   **Removed Keywords**: `repeat`, `until`, and `local` have been removed to simplify the language. Use `while` loops instead.

### 3. Enhanced String & Data Support
*   **Triple Quoted Strings**: Use `"""` for multiline strings (replacing `[[...]]`).
    ```lua
    s = """
    Multi-line
    String
    """
    ```
*   **Hexadecimal Escapes**: Use `\xXX` for characters in strings (e.g., `"\x41"` is "A").
    ```lua
    str = "Lua\x4D" -- LuaM
    ```
*   **`__len` Metamethod**: Tables support the `__len` metamethod (from Lua 5.2).
    ```lua
    mt = { __len = function(t) return 42 end }
    ```

### 4. Improved Standard Library
*   **`xpcall` with Arguments**: `xpcall` now accepts arguments to pass to the function (from Lua 5.2).
    ```lua
    xpcall(func, handler, arg1, arg2)
    ```
*   **Unified `load`**: `load(chunk)` handles both functions (as `load` did) and strings (replacing `loadstring`).
    ```lua
    load("return 1") -- Works like loadstring
    ```
*   **Math & Table Enhancements**:
    *   `math.log(x, base)`: Supports optional base argument.
    *   `table.pack(...)`: Creates a table from arguments with field `n`.
    *   `table.unpack(t)`: Unpacks a table (renamed from `unpack`, though global `unpack` remains).
*   **System & Packages**:
    *   `os.exit(boolean)`: Pass `true` (success) or `false` (failure).
    *   `package.searchers`: Alias for `package.loaders` for 5.2 compatibility.

## Build & Install

LuaM is implemented in strict ANSI C (C89) and compiles on almost any platform.

### Building
Use `make` with your platform (e.g., `linux`, `macosx`, `posix`, `ansi`):

```sh
make linux
```

This will produce the binaries in `bld/`:
*   `bld/lua`: The interpreter
*   `bld/luac`: The compiler

### Running Tests
To run the full regression suite:

```sh
make test
```

## License
LuaM is free software, released under the MIT license (same as Lua 5.1).
See [COPYRIGHT](COPYRIGHT) for details.
